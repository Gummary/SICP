---
layout: post
title:  Exercise 5.11
date:   2016-12-02
description: Post on 02 December,2016 by Gummary
categories:
- blog
---

# a)

可以删除的语句在afterfib-n-2之后。

在转到该标号后，val的内容为Fib(n-1),可以将n赋值为栈顶元素，直接与val相加复制给val即可

~~~scheme
afterfibe-n-2
  (restore n)
  (restore continue)
  (assign val (op +) (reg val) (reg n))
  ...
~~~

# b)

在压栈时压入的是寄存器的名字和内容，取出时判断名称是否一致即可。

~~~scheme
(define (make-save inst machine stack pc)
  (let ((reg (get-register machine
                           (stack-inst-reg-name inst))))
    (lambda ()
      (push stack (cons (stack-inst-reg-name inst)
			(get-contents reg)))
      (advance-pc pc))))


(define (make-restore inst machine stack pc)
  (let ((reg (get-register machine
                           (stack-inst-reg-name inst))))
    (lambda ()
      (let (stack-top (pop stack))
	(let ((reg-name (car stack-top))
	      (reg-value (cadr stack-top)))
	  (if (equal? reg-name (stack-inst-reg-name inst)) 
	    (set-contents! reg (pop stack))
	    (error "REG name is not equal to this MAKE-RESTORE" reg-name))
	  (advance-pc pc))))))
~~~

# c)

不会┑(￣Д ￣)┍
  