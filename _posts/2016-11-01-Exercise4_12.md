---
layout: post
title:  Exercise 4.12
date:   2016-11-01
description: Post on 1 November,2016 by Gummary
categories:
- blog
---

我把scan抽象出来，如果找到该变量返回该变量所在的表，如果不存在则返回false

~~~
(define (scan var vars vals env)
  (cond ((null? vars)
	 false)
	((eq? var (car vars))
	 vals)
	(else (scan var (cdr vars) (cdr vals) env))))

(define (lookup-variable-value var env)
  (define (env-loop env)
    (if (eq? env the-empty-environment)
      (error "Unbound variable" var)
      (let ((frame (frist-frame env)))
	(let ((result (scan var (frame-variables frame) (frame-values frame)env)))
	  (if result
	    (car result)
	    (env-loop (enclosing-environment env)))))))
  (env-loop env))

(define (set-variable-value var value env)
  (define (env-loop env)
    (if (eq? env the-empty-environment)
      (error "Unbound variable" var)
      (let ((frame (frist-frame env)))
	(let ((result (scan var (frame-variables frame) (frame-values frame)env)))
	  (if result
	    (set-car! result value)
	    (env-loop (enclosing-environment env)))))))
  (env-loop env))

(define (define-variable! var val env)
  (let ((frame (first-frame env)))
    (let ((result (scan var (frame-variables frame) (frame-values frame) env)))
      (if result
	(set-car! result val)
	(add-binding-to-frame! var val env)))))
